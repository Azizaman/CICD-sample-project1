# CI usually does:

#1) Install dependencies

#2) Build the app

#3) Run tests

#4) Lint / checks

# ðŸ“Œ CI never deploys


name: Task 3 CI workflow

on:
    workflow_dispatch:
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            #checkout the code
            - name: checkout the code
              uses: actions/checkout@v4
            - name: set up the node js envirnment
              uses: actions/setup-node@v3
            - name: install dependecies
              run: npm install
            - name: install jest
              run: npm install --save-dev jest
            - name: run the tests
              run: npm test
            - name: lint the code
              run: npx eslint --init
            - name: run the lint
              run: npm run lint
    deploy:
        name: CD workflow to push docker image to hub
        runs-on: ubuntu-latest
        needs: build
        # ðŸ”’ CD runs ONLY on main branch
        if: github.ref == 'refs/heads/main'
        steps:
            - name: checkout the code 
              uses: actions/checkout@v4
            - name: Login with the docker hub
              uses: docker/login-action@v2
              with:
                    username: ${{secrets.DOCKER_HUB_USERNAME}}
                    password: ${{secrets.DOCKER_HUB_ACCESS_TOKEN}}
            - name: build  docker image
              run: |
                TAG=${{github.sha}}
                docker build -t ${{secrets.DOCKER_HUB_USERNAME}}/task3-app:$TAG .
            - name: push the docker image
              run: docker push ${{secrets.DOCKER_HUB_USERNAME}}/task3-app:$TAG



# CD usually does:

# Build Docker image

# Push image

# Deploy to server / cloud

# ðŸ“Œ CD should be controlled and restricted
# via protected branches or manual approvals
# ðŸ“Œ CD never runs tests
    



